<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="utf-8"/>
    <style>
        #log{
            margin-top: 10px; padding: 5px; border: 2px solid gray; font-size: 11px; font-family: sans-serif; color: gray;
            height:400px;
            overflow:scroll;
        }
    </style>
</head>
<body>

        <button id="popButton" data-uri="popup.html">pop...</button>
        <button id="popButtonR" data-uri="popup-r.html">pop with redirect</button>
        <button id="popButtonRS" data-uri="http://wellcomelibrary.org/iiif/caslogin">redirected server side</button>

<hr/>

<div id="log"></div>

  <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>

  <script type="text/javascript">

    function log(text) {
        var logDiv = $('#log');
        logDiv.append(text + "<br>");
        logDiv.scrollTop(logDiv[0].scrollHeight);
        console.log(text);
    }

    function do_pop(ev) {
        var uri = $(this).attr('data-uri');
          var win = window.open(uri); //
          var pollTimer = window.setInterval(function () {
              if (win.closed) {
                  window.clearInterval(pollTimer);
                  log('Window closed, now call token service...')
              } else {
                log('window still open.')
              }
          }, 500);
        }


        $('button').bind('click', do_pop);




</script>
</body>
</html>
